# AnsibleSec Secrets Detection Rules
# This file contains patterns for detecting hardcoded secrets in Ansible playbooks
# Each rule must have: id, name, pattern, severity, description, enabled

rules:
  # ===== AWS Secrets =====
  - id: SECRET_AWS_ACCESS_KEY
    name: "AWS Access Key ID"
    pattern: 'AKIA[0-9A-Z]{16}'
    severity: CRITICAL
    description: "AWS Access Key ID detected"
    enabled: true

  - id: SECRET_AWS_SECRET_KEY
    name: "AWS Secret Access Key"
    pattern: 'aws(.{0,20})?[''"][0-9a-zA-Z/+]{40}[''"]'
    severity: CRITICAL
    description: "AWS Secret Access Key detected"
    enabled: true

  - id: SECRET_AWS_SESSION_TOKEN
    name: "AWS Session Token"
    pattern: 'aws(.{0,20})?session(.{0,20})?token(.{0,20})?[''"][a-zA-Z0-9/+=]{100,}[''"]'
    severity: HIGH
    description: "AWS Session Token detected"
    enabled: true

  - id: SECRET_AWS_MWS_KEY
    name: "AWS MWS Key"
    pattern: 'amzn\.mws\.[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'
    severity: CRITICAL
    description: "Amazon Marketplace Web Service (MWS) Key detected"
    enabled: true

  # ===== Azure Secrets =====
  - id: SECRET_AZURE_STORAGE_KEY
    name: "Azure Storage Account Key"
    pattern: 'AccountKey=[a-zA-Z0-9+/=]{88}'
    severity: CRITICAL
    description: "Azure Storage Account Key detected"
    enabled: true

  - id: SECRET_AZURE_CONNECTION_STRING
    name: "Azure Connection String"
    pattern: 'DefaultEndpointsProtocol=https;AccountName=[a-z0-9]+;AccountKey=[a-zA-Z0-9+/=]{88}'
    severity: CRITICAL
    description: "Azure Connection String detected"
    enabled: true

  - id: SECRET_AZURE_CLIENT_SECRET
    name: "Azure Client Secret"
    pattern: 'azure(.{0,20})?client(.{0,20})?secret(.{0,20})?[''"][a-zA-Z0-9~._-]{34,}[''"]'
    severity: CRITICAL
    description: "Azure Client Secret detected"
    enabled: true

  - id: SECRET_AZURE_SAS_TOKEN
    name: "Azure SAS Token"
    pattern: 'sig=[a-zA-Z0-9%]{43,53}%3D'
    severity: HIGH
    description: "Azure Shared Access Signature (SAS) Token detected"
    enabled: true

  # ===== GCP Secrets =====
  - id: SECRET_GCP_API_KEY
    name: "Google Cloud Platform API Key"
    pattern: 'AIza[0-9A-Za-z\-_]{35}'
    severity: CRITICAL
    description: "GCP API Key detected"
    enabled: true

  - id: SECRET_GCP_SERVICE_ACCOUNT
    name: "GCP Service Account Key"
    pattern: '"type":\s*"service_account"'
    severity: CRITICAL
    description: "GCP Service Account JSON detected"
    enabled: true

  - id: SECRET_GCP_OAUTH_TOKEN
    name: "Google OAuth Access Token"
    pattern: 'ya29\.[0-9A-Za-z\-_]+'
    severity: HIGH
    description: "Google OAuth Access Token detected"
    enabled: true

  # ===== GitHub Secrets =====
  - id: SECRET_GITHUB_TOKEN
    name: "GitHub Personal Access Token"
    pattern: 'ghp_[0-9a-zA-Z]{36}'
    severity: CRITICAL
    description: "GitHub Personal Access Token detected"
    enabled: true

  - id: SECRET_GITHUB_OAUTH
    name: "GitHub OAuth Access Token"
    pattern: 'gho_[0-9a-zA-Z]{36}'
    severity: CRITICAL
    description: "GitHub OAuth Access Token detected"
    enabled: true

  - id: SECRET_GITHUB_APP_TOKEN
    name: "GitHub App Token"
    pattern: '(ghu|ghs)_[0-9a-zA-Z]{36}'
    severity: CRITICAL
    description: "GitHub App/Server Token detected"
    enabled: true

  - id: SECRET_GITHUB_REFRESH_TOKEN
    name: "GitHub Refresh Token"
    pattern: 'ghr_[0-9a-zA-Z]{36}'
    severity: CRITICAL
    description: "GitHub Refresh Token detected"
    enabled: true

  # ===== GitLab Secrets =====
  - id: SECRET_GITLAB_PAT
    name: "GitLab Personal Access Token"
    pattern: 'glpat-[0-9a-zA-Z\-_]{20}'
    severity: CRITICAL
    description: "GitLab Personal Access Token detected"
    enabled: true

  - id: SECRET_GITLAB_RUNNER_TOKEN
    name: "GitLab Runner Registration Token"
    pattern: 'GR1348941[0-9a-zA-Z\-_]{20}'
    severity: HIGH
    description: "GitLab Runner Token detected"
    enabled: true

  # ===== Bitbucket Secrets =====
  - id: SECRET_BITBUCKET_CLIENT_ID
    name: "Bitbucket Client ID"
    pattern: 'bitbucket(.{0,20})?client(.{0,20})?id(.{0,20})?[''"][a-zA-Z0-9]{32}[''"]'
    severity: HIGH
    description: "Bitbucket Client ID detected"
    enabled: true

  - id: SECRET_BITBUCKET_CLIENT_SECRET
    name: "Bitbucket Client Secret"
    pattern: 'bitbucket(.{0,20})?client(.{0,20})?secret(.{0,20})?[''"][a-zA-Z0-9]{64}[''"]'
    severity: CRITICAL
    description: "Bitbucket Client Secret detected"
    enabled: true

  # ===== Slack Secrets =====
  - id: SECRET_SLACK_TOKEN
    name: "Slack Token"
    pattern: 'xox[baprs]-[0-9]{10,13}-[0-9]{10,13}-[a-zA-Z0-9]{24,32}'
    severity: HIGH
    description: "Slack Token detected"
    enabled: true

  - id: SECRET_SLACK_WEBHOOK
    name: "Slack Webhook URL"
    pattern: 'https://hooks\.slack\.com/services/T[a-zA-Z0-9_]{8}/B[a-zA-Z0-9_]{8}/[a-zA-Z0-9_]{24}'
    severity: HIGH
    description: "Slack Webhook URL detected"
    enabled: true

  # ===== Stripe Secrets =====
  - id: SECRET_STRIPE_KEY_LIVE
    name: "Stripe Live API Key"
    pattern: 'sk_live_[0-9a-zA-Z]{24,}'
    severity: CRITICAL
    description: "Stripe Live API Key detected"
    enabled: true

  - id: SECRET_STRIPE_KEY_TEST
    name: "Stripe Test API Key"
    pattern: 'sk_test_[0-9a-zA-Z]{24,}'
    severity: MEDIUM
    description: "Stripe Test API Key detected"
    enabled: true

  - id: SECRET_STRIPE_RESTRICTED_KEY
    name: "Stripe Restricted API Key"
    pattern: 'rk_(live|test)_[0-9a-zA-Z]{24,}'
    severity: HIGH
    description: "Stripe Restricted API Key detected"
    enabled: true

  # ===== Twilio Secrets =====
  - id: SECRET_TWILIO_API_KEY
    name: "Twilio API Key"
    pattern: 'SK[0-9a-fA-F]{32}'
    severity: HIGH
    description: "Twilio API Key detected"
    enabled: true

  - id: SECRET_TWILIO_ACCOUNT_SID
    name: "Twilio Account SID"
    pattern: 'AC[a-zA-Z0-9]{32}'
    severity: MEDIUM
    description: "Twilio Account SID detected"
    enabled: true

  # ===== SendGrid Secrets =====
  - id: SECRET_SENDGRID_API_KEY
    name: "SendGrid API Key"
    pattern: 'SG\.[a-zA-Z0-9_\-]{22}\.[a-zA-Z0-9_\-]{43}'
    severity: HIGH
    description: "SendGrid API Key detected"
    enabled: true

  # ===== Mailgun Secrets =====
  - id: SECRET_MAILGUN_API_KEY
    name: "Mailgun API Key"
    pattern: 'key-[0-9a-zA-Z]{32}'
    severity: HIGH
    description: "Mailgun API Key detected"
    enabled: true

  # ===== DigitalOcean Secrets =====
  - id: SECRET_DIGITALOCEAN_TOKEN
    name: "DigitalOcean Personal Access Token"
    pattern: 'dop_v1_[a-f0-9]{64}'
    severity: CRITICAL
    description: "DigitalOcean Personal Access Token detected"
    enabled: true

  - id: SECRET_DIGITALOCEAN_SPACES_KEY
    name: "DigitalOcean Spaces Access Key"
    pattern: 'digitalocean(.{0,20})?spaces(.{0,20})?key(.{0,20})?[''"][0-9A-Z]{20}[''"]'
    severity: HIGH
    description: "DigitalOcean Spaces Access Key detected"
    enabled: true

  # ===== Heroku Secrets =====
  - id: SECRET_HEROKU_API_KEY
    name: "Heroku API Key"
    pattern: 'heroku(.{0,20})?api(.{0,20})?key(.{0,20})?[''"][0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}[''"]'
    severity: HIGH
    description: "Heroku API Key detected"
    enabled: true

  # ===== NPM Secrets =====
  - id: SECRET_NPM_TOKEN
    name: "NPM Access Token"
    pattern: 'npm_[a-zA-Z0-9]{36}'
    severity: HIGH
    description: "NPM Access Token detected"
    enabled: true

  # ===== PyPI Secrets =====
  - id: SECRET_PYPI_TOKEN
    name: "PyPI Upload Token"
    pattern: 'pypi-AgEIcHlwaS5vcmc[a-zA-Z0-9\-_]{50,}'
    severity: HIGH
    description: "PyPI Upload Token detected"
    enabled: true

  # ===== Docker Secrets =====
  - id: SECRET_DOCKER_CONFIG
    name: "Docker Config with Auth"
    pattern: '"auths":\s*\{[^}]+"auth":\s*"[a-zA-Z0-9+/=]+'
    severity: HIGH
    description: "Docker authentication credentials detected"
    enabled: true

  # ===== SSH Keys =====
  - id: SECRET_SSH_PRIVATE_KEY
    name: "SSH Private Key"
    pattern: '-----BEGIN (RSA|DSA|EC|OPENSSH) PRIVATE KEY-----'
    severity: CRITICAL
    description: "SSH Private Key detected"
    enabled: true

  - id: SECRET_PGP_PRIVATE_KEY
    name: "PGP Private Key"
    pattern: '-----BEGIN PGP PRIVATE KEY BLOCK-----'
    severity: CRITICAL
    description: "PGP Private Key detected"
    enabled: true

  # ===== Database URIs =====
  - id: SECRET_MONGODB_URI
    name: "MongoDB Connection String"
    pattern: 'mongodb(\+srv)?://[a-zA-Z0-9_\-]+:[a-zA-Z0-9_\-]+@'
    severity: CRITICAL
    description: "MongoDB connection string with credentials detected"
    enabled: true

  - id: SECRET_POSTGRESQL_URI
    name: "PostgreSQL Connection String"
    pattern: 'postgres(ql)?://[a-zA-Z0-9_\-]+:[a-zA-Z0-9_\-]+@'
    severity: CRITICAL
    description: "PostgreSQL connection string with credentials detected"
    enabled: true

  - id: SECRET_MYSQL_URI
    name: "MySQL Connection String"
    pattern: 'mysql://[a-zA-Z0-9_\-]+:[a-zA-Z0-9_\-]+@'
    severity: CRITICAL
    description: "MySQL connection string with credentials detected"
    enabled: true

  - id: SECRET_REDIS_URI
    name: "Redis Connection String"
    pattern: 'redis://[a-zA-Z0-9_\-]+:[a-zA-Z0-9_\-]+@'
    severity: HIGH
    description: "Redis connection string with credentials detected"
    enabled: true

  # ===== JWT Tokens =====
  - id: SECRET_JWT_TOKEN
    name: "JWT Token"
    pattern: 'eyJ[A-Za-z0-9-_=]+\.eyJ[A-Za-z0-9-_=]+\.[A-Za-z0-9-_.+/=]*'
    severity: HIGH
    description: "JWT token detected"
    enabled: true

  # ===== Generic Secrets =====
  - id: SECRET_GENERIC_API_KEY
    name: "Generic API Key"
    pattern: '(api[_-]?key|apikey)[''""\s:=]+[''""]?[0-9a-zA-Z\-_]{20,}[''""]?'
    severity: HIGH
    description: "Generic API key pattern detected"
    enabled: true

  - id: SECRET_GENERIC_SECRET
    name: "Generic Secret"
    pattern: '(secret|password|passwd|pwd)[''""\s:=]+[''""]?[0-9a-zA-Z\-_!@#$%^&*()]{8,}[''""]?'
    severity: HIGH
    description: "Generic secret pattern detected"
    enabled: true

  - id: SECRET_GENERIC_TOKEN
    name: "Generic Token"
    pattern: '(token|auth)[''""\s:=]+[''""]?[0-9a-zA-Z\-_]{20,}[''""]?'
    severity: MEDIUM
    description: "Generic token pattern detected"
    enabled: true

  - id: SECRET_GENERIC_KEY
    name: "Generic Key"
    pattern: '(key|access_key)[''""\s:=]+[''""]?[0-9a-zA-Z\-_]{20,}[''""]?'
    severity: MEDIUM
    description: "Generic key pattern detected"
    enabled: true

  # ===== Cloud Platform Secrets =====
  - id: SECRET_CLOUDFLARE_API_KEY
    name: "Cloudflare API Key"
    pattern: 'cloudflare(.{0,20})?api(.{0,20})?key(.{0,20})?[''"][a-zA-Z0-9_\-]{37}[''"]'
    severity: HIGH
    description: "Cloudflare API Key detected"
    enabled: true

  - id: SECRET_DATADOG_API_KEY
    name: "Datadog API Key"
    pattern: '[''"]?[a-f0-9]{32}[''"]?'
    severity: MEDIUM
    description: "Potential Datadog API Key detected"
    enabled: true

  - id: SECRET_NEWRELIC_LICENSE_KEY
    name: "New Relic License Key"
    pattern: 'NRAK-[A-Z0-9]{27}'
    severity: HIGH
    description: "New Relic License Key detected"
    enabled: true

  # ===== Payment Gateway Secrets =====
  - id: SECRET_PAYPAL_TOKEN
    name: "PayPal Token"
    pattern: 'access_token\$production\$[a-z0-9]{16}\$[a-f0-9]{32}'
    severity: CRITICAL
    description: "PayPal access token detected"
    enabled: true

  - id: SECRET_SQUARE_TOKEN
    name: "Square Access Token"
    pattern: 'sq0atp-[0-9A-Za-z\-_]{22}'
    severity: CRITICAL
    description: "Square Access Token detected"
    enabled: true

  - id: SECRET_SQUARE_OAUTH
    name: "Square OAuth Secret"
    pattern: 'sq0csp-[0-9A-Za-z\-_]{43}'
    severity: CRITICAL
    description: "Square OAuth Secret detected"
    enabled: true

  # ===== CI/CD Secrets =====
  - id: SECRET_CIRCLECI_TOKEN
    name: "CircleCI Token"
    pattern: 'circleci(.{0,20})?token(.{0,20})?[''"][a-f0-9]{40}[''"]'
    severity: HIGH
    description: "CircleCI token detected"
    enabled: true

  - id: SECRET_TRAVIS_TOKEN
    name: "Travis CI Token"
    pattern: 'travis(.{0,20})?token(.{0,20})?[''"][a-zA-Z0-9_\-]{22}[''"]'
    severity: HIGH
    description: "Travis CI token detected"
    enabled: true

  # ===== Messaging Platform Secrets =====
  - id: SECRET_TELEGRAM_BOT_TOKEN
    name: "Telegram Bot Token"
    pattern: '[0-9]{8,10}:[a-zA-Z0-9_-]{35}'
    severity: HIGH
    description: "Telegram Bot API token detected"
    enabled: true

  - id: SECRET_DISCORD_TOKEN
    name: "Discord Bot Token"
    pattern: '[MN][a-zA-Z\d_-]{23,25}\.[a-zA-Z\d_-]{6}\.[a-zA-Z\d_-]{27}'
    severity: HIGH
    description: "Discord Bot token detected"
    enabled: true

  - id: SECRET_DISCORD_WEBHOOK
    name: "Discord Webhook URL"
    pattern: 'https://discord(app)?\.com/api/webhooks/[0-9]{18}/[a-zA-Z0-9_-]+'
    severity: MEDIUM
    description: "Discord Webhook URL detected"
    enabled: true

  # ===== Additional Cloud Providers =====
  - id: SECRET_ALIBABA_ACCESS_KEY
    name: "Alibaba Cloud Access Key"
    pattern: 'LTAI[a-zA-Z0-9]{12,20}'
    severity: CRITICAL
    description: "Alibaba Cloud Access Key ID detected"
    enabled: true

  - id: SECRET_TENCENT_SECRET_ID
    name: "Tencent Cloud Secret ID"
    pattern: 'AKID[a-zA-Z0-9]{32,}'
    severity: CRITICAL
    description: "Tencent Cloud Secret ID detected"
    enabled: true
